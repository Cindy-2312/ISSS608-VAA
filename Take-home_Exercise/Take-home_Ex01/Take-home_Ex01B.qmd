---
title: "Take-home Exercise 1B"
author: "Cindy TA"
---

# 1. Introduction

## 1.1. Setting the scene

A local online media company that publishes daily content on digital platforms is planning to release an article on **demographic structures and distribution of Singapore in 2024**.

## 1.2. The task

In this take-home exercise, we are assuming the role of the graphical editor of the media company,and are tasked to prepare **at most three data visualisation** for the article.

# 2. Getting Started

## 2.1. Importing packages and libraries

```{r}
pacman::p_load(ggrepel, patchwork, 
               ggthemes, hrbrthemes,
               tidyverse, ggplot2) 
```

## 2.2. Importing data

The dataset shared by Department of Statistics, Singapore (DOS), *Singapore Residents by Planning Area / Subzone, Single Year of Age and Sex, June 2024*, is used

```{r}
pop_data <- read_csv("data/respopagesex2024.csv")
glimpse(pop_data)
```

## 2.3. Exploring data

```{r}
summary(pop_data)
unique(pop_data$PA)
unique(pop_data$Sex)
range(pop_data$Age)
```

# 3. Data Visualisation

"Singapore’s population is not just aging—it is unevenly distributed across regions by age structure and gender, creating a multi-dimensional urban planning challenge. Certain districts are aging faster, while others remain youth-centric. Meanwhile, gender imbalances appear in elderly cohorts, hinting at future care demand disparities."

## 3.1. Faceted age pyramid by region type

```{r}
#Step 1: Map each Planning Area to a Region
# Manually define Planning Area to Region map
region_map <- tibble::tibble(
  PA = c("Tampines", "Pasir Ris", "Bedok", "Hougang", "Sengkang", "Punggol", "Serangoon",
         "Toa Payoh", "Bishan", "Ang Mo Kio", "Bukit Merah", "Queenstown", "Clementi", 
         "Jurong East", "Jurong West", "Choa Chu Kang", "Woodlands", "Yishun", "Bukit Batok",
         "Bukit Panjang", "Sembawang", "Geylang", "Kallang", "Rochor", "Outram"),
  Region = c("East", "East", "East", "North-East", "North-East", "North-East", "North-East",
             "Central", "Central", "Central", "Central", "Central", "West", 
             "West", "West", "West", "North", "North", "West",
             "West", "North", "Central", "Central", "Central", "Central")
)

```

```{r}
#Step 2: Prepare faceted pyramid data
pyramid_data <- pop_data %>%
  left_join(region_map, by = "PA") %>%
  filter(!is.na(Region)) %>%
  group_by(Region, Age, Sex) %>%
  summarise(Pop = sum(Pop), .groups = "drop") %>%
  mutate(Pop = ifelse(Sex == "Males", -Pop, Pop))

#Step 3: Plotting
ggplot(pyramid_data, aes(x = Age, y = Pop, fill = Sex)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  facet_wrap(~ Region, scales = "free_y") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_discrete(breaks = seq(0, 100, by = 10)) +
  scale_fill_manual(values = c("Males" = "#1F77B4", "Females" = "#FF69B4")) +
  labs(title = "Age Distribution by Region in Singapore (2024)",
       x = "Age", y = "Population") +
  theme_minimal()

```

## 3.2. Heatmap of Elderly Share (%) by Planning Area

```{r}
# Step 1
# Group age into categories
pop_grouped <- pop_data %>%
  mutate(AgeGroup = case_when(
    Age < 15 ~ "0-14",
    Age < 25 ~ "15-24",
    Age < 65 ~ "25-64",
    TRUE     ~ "65+"
  ))




# Step 2: 
top20_pas <- pop_grouped %>%
  group_by(PA) %>%
  summarise(Total = sum(Pop), .groups = "drop") %>%
  slice_max(Total, n = 20) %>%
  pull(PA)


# Step 3: 
age_share_filtered <- pop_grouped %>%
  filter(PA %in% top20_pas) %>%
  group_by(PA, AgeGroup) %>%
  summarise(GroupPop = sum(Pop), .groups = "drop") %>%
  group_by(PA) %>%
  mutate(TotalPop = sum(GroupPop),
         Share = GroupPop / TotalPop * 100)

# Step 4: 
# Order age groups and PAs (e.g., by elderly share)
elderly_order <- age_share_filtered %>%
  filter(AgeGroup == "65+") %>%
  arrange(desc(Share)) %>%
  pull(PA)

age_share_filtered <- age_share_filtered %>%
  mutate(
    PA = factor(PA, levels = elderly_order),
    AgeGroup = factor(AgeGroup, levels = c("0-14", "15-24", "25-64", "65+"))
  )

# Step 5: 
ggplot(age_share_filtered, aes(x = AgeGroup, y = PA, fill = Share)) +
  geom_tile(color = "white", width = 0.95, height = 0.95) +
  scale_fill_viridis_c(name = "Age Group %", option = "C") +
  labs(
    title = "Age Group Distribution in Top 20 Most Populated Planning Areas (2024)",
    x = "Age Group", y = "Planning Area"
  ) +
  theme_classic() +
  theme(
    axis.text.y = element_text(size = 9),
    axis.text.x = element_text(size = 10),
    panel.grid = element_blank()
  )



```

## 3.3.
